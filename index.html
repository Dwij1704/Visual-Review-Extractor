<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Review Extractor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            transition: background-color 0.3s, color 0.3s;
        }

        body.dark-mode {
            background-color: #333;
            color: #fff;
        }

        .dark-mode .card {
            background-color: #444;
            color: #fff;
        }

        .dark-mode .modal-content {
            background-color: #333;
            color: #fff;
        }

        #darkModeToggle {
            position: fixed;
            top: 10px;
            left: 10px;
            z-index: 1030;
        }

        #logsToggle {
            position: fixed;
            top: 10px;
            right: 10px;
            z-index: 1030;
        }

        #loadingIndicator {
            display: none;
        }

        .spinner-border {
            width: 3rem;
            height: 3rem;
        }

        #factTimer {
            transition: width 1s linear;
        }

        .preset-btn {
            margin-right: 5px;
            margin-bottom: 5px;
        }
    </style>
</head>

<body>
    <button id="darkModeToggle" class="btn btn-sm btn-outline-primary" onclick="toggleDarkMode()">ðŸŒ“</button>
    <button id="logsToggle" class="btn btn-sm btn-outline-info" onclick="toggleLogs()">ðŸ“œ</button>

    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-8">
                <h1 class="text-center mb-4">Review Extractor</h1>
                <div class="input-group mb-3">
                    <input type="text" id="urlInput" class="form-control" placeholder="Enter product page URL">
                    <button class="btn btn-primary" onclick="extractReviews()">Extract Reviews</button>
                </div>
                <div class="mb-3">
                    <h5>Presets:</h5>
                    <button class="btn btn-sm btn-outline-secondary preset-btn" onclick="setPreset('https://ridge.com/products/daily-driver-kit-matte-olive')">Product 1</button>
                    <button class="btn btn-sm btn-outline-secondary preset-btn" onclick="setPreset('https://sokoglam.com/products/im-from-rice-toner-150ml')">Product 2</button>
                    <button class="btn btn-sm btn-outline-secondary preset-btn" onclick="setPreset('https://2717recovery.com/products/recovery-cream')">Product 3</button>
                    <button class="btn btn-sm btn-outline-secondary preset-btn" onclick="setPreset('https://secretlab.co/products/magnus-pro?sku=4MPB2-B15B-STELH')">Product 4</button>
                </div>
                <div id="loadingIndicator" class="text-center mt-4">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Loading...</span>
                    </div>
                    <p class="mt-2">Extracting reviews... This may take a while.</p>
                    <div id="factBox" class="card mt-3">
                        <div class="card-body">
                            <h5 class="card-title">Did you know?</h5>
                            <p id="fact" class="card-text"></p>
                            <div class="progress">
                                <div id="factTimer" class="progress-bar" role="progressbar" style="width: 100%;"
                                    aria-valuenow="100" aria-valuemin="0" aria-valuemax="100"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="reviews" class="mt-4"></div>
            </div>
        </div>
    </div>

    <!-- Logs Modal -->
    <div class="modal fade" id="logsModal" tabindex="-1" aria-labelledby="logsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="logsModalLabel">Server Logs</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <pre id="logs"></pre>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let logsModal;
        let factInterval;
        let timerInterval;

        const facts = [
            "I've crafted a suite of HRMS products that make life a little easier for HR teams. It's all about streamlining processes and helping everyone stay organizedâ€”after all, who doesn't want a smoother workflow?",
            "My journey included designing a user-friendly HR platform with features like payroll management and employee onboarding. I love making things easier for users, so they can focus on what really matters.",
            "I've had the chance to implement CI/CD pipelines for our HRMS products, which has helped in delivering updates faster and with fewer hiccups. Nothing like a smooth deployment to brighten a developer's day!",
            "With a strong focus on security and compliance, I've deployed applications on AWS, ensuring that platforms handling sensitive customer data, like HRMS and vendor management systems, adhere to modern security standards using AWS services like Cognito, CloudWatch, and EC2.",
            "By utilizing AWS services for deployment, I've managed to ensure that our HRMS products are scalable and reliable. It feels good to know they can handle growing user bases without breaking a sweat.",
            "I've enjoyed collaborating with cross-functional teams to gather feedback and improve our HRMS tools. Listening to user needs is key, and it's rewarding to see those changes make a positive impact.",
            "I've worked on integrating Microsoft PromptFlow to enhance content generation and data analytics workflows, ensuring that AI-powered solutions are seamlessly integrated with business objectives to drive innovation and efficiency.",
            "With Docker and Kubernetes, I make sure microservices run like a well-oiled machine. Because nobody likes downtimeâ€”especially when it makes customers 31% less likely to spend their hard-earned cash.",
        ];

        function displayRandomFact() {
            const factElement = document.getElementById('fact');
            factElement.textContent = facts[Math.floor(Math.random() * facts.length)];
            startFactTimer();
        }

        function startFactTimer() {
            const timerElement = document.getElementById('factTimer');
            let width = 100;
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                if (width <= 0) {
                    clearInterval(timerInterval);
                } else {
                    width -= 1;
                    timerElement.style.width = width + '%';
                }
            }, 100);
        }

        document.addEventListener('DOMContentLoaded', (event) => {
            logsModal = new bootstrap.Modal(document.getElementById('logsModal'));
            displayRandomFact();
        });

        function extractReviews() {
            const url = document.getElementById('urlInput').value;
            const reviewsDiv = document.getElementById('reviews');
            const loadingIndicator = document.getElementById('loadingIndicator');
        
            reviewsDiv.innerHTML = '';
            loadingIndicator.style.display = 'block';
        
            // Start changing facts every 10 seconds
            displayRandomFact();
            factInterval = setInterval(displayRandomFact, 12000);
        
            fetch('/api/reviews?page=' + encodeURIComponent(url))
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Error ${response.status}: ${response.statusText}`);
                    }
                    return response.json();
                })
                .then(data => {
                    loadingIndicator.style.display = 'none';
                    clearInterval(factInterval);
                    clearInterval(timerInterval);
        
                    if (data.reviews && data.reviews.length > 0) {
                        data.reviews.forEach(review => {
                            const reviewElement = document.createElement('div');
                            reviewElement.className = 'card mb-3';
                            reviewElement.innerHTML = `
                                <div class="card-body">
                                    <h5 class="card-title">${review.title}</h5>
                                    <h6 class="card-subtitle mb-2 text-muted">Rating: ${review.rating}/5</h6>
                                    <p class="card-text">${review.body}</p>
                                    <footer class="blockquote-footer">By: ${review.reviewer}</footer>
                                </div>
                            `;
                            reviewsDiv.appendChild(reviewElement);
                        });
                    } else {
                        reviewsDiv.innerHTML = '<div class="alert alert-warning">No reviews found.</div>';
                    }
                })
                .catch(error => {
                    loadingIndicator.style.display = 'none';
                    clearInterval(factInterval);
                    clearInterval(timerInterval);
                    reviewsDiv.innerHTML = '<div class="alert alert-danger">Error: ' + error.message + '</div>';
                });
        }
        
        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
        }

        function toggleLogs() {
            fetch('/api/logs')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('logs').textContent = data;
                    logsModal.show();
                })
                .catch(error => {
                    document.getElementById('logs').textContent = 'Error fetching logs: ' + error.message;
                    logsModal.show();
                });
        }

        function setPreset(url) {
            document.getElementById('urlInput').value = url;
        }
    </script>
</body>

</html>